{% include './theme.html' %}

<body>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--page-background);
      color: var(--page-color);
      background-size: cover;
      background-repeat: no-repeat;
      overflow-x: hidden;
      transition: 0.5s;
      overflow-y: hidden;
    }

    #main {
      text-align: center;
    }

    .heading {
      padding: 12px 0px;
      font-size: 4em;
      margin: 191px 0px 0px 0px;
      position: relative;
      font-weight: bold;
    }

    .title {
      font-weight: 400;
      margin: 1.5rem 0px 0.5rem;
      padding: 0.5em 0px 0.25em;
      line-height: 1;
    }

    .container-80 {
      max-width: 100vw;
      padding-left: 25%;
    }



    .voice {
      height: 20px;
      position: relative;
      top: 5px;
      left: 10px;
    }


    .fa-search {
      font-size: 20px;
      color: red;
    }

    .fa-search:hover {
      color: white;
    }

    .buttons {
      margin-top: 30px;
    }

    .theme-toggler {
      position: absolute !important;
    }
  </style>
  <style>
    .searchform-container {
      margin-left: 0;
      width: 100%;
      padding-left: 1rem;
      padding-right: 1rem;
    }

    #searchform {
      position: relative;
      display: flex;
      margin-bottom: 10px;
      max-width: inherit;
      align-items: center;
      z-index: 3;
      height: 56px !important;
      width: 90%;
      border: var(--border-color);
      border-radius: 8px;
      box-shadow: 0px 2px 8px rgb(37 44 54 / 25%);
      background-color: var(--input-color);
      transition: all 0.3s ease-in-out;
    }

    #search-icon.no-display {
      display: flex !important;
      transition: all 0.1s ease-in-out;
    }

    #search-icon {
      opacity: 0.5 !important;
      transition: all 0.1s ease-in-out;
    }

    #search-icon,
    #back-arrow {
      display: flex;
      height: 100%;
      justify-content: center;
      align-items: center;
      min-width: 46px !important;
      order: 1;
      z-index: 3;
      color: var(--page-color);
      transition: all 0.1s ease-in-out;
    }

    #query {
      flex-grow: 1;
      width: inherit;
      height: 100%;
      order: 2;
      border: none;
      outline: none;
      box-shadow: none;
      color: var(--page-color);
      background-color: var(--input-color);
      border-radius: 8px;
      border-top-left-radius: 10px;
      border-bottom-left-radius: 10px;
      padding: 8px 18px;
      padding-left: 0px !important;
      transition: all 0.3s ease-in-out;
    }

    .form-input {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background: var(--input-color);
      background-image: none;
      border: .05rem solid #bcc3ce;
      border-radius: .1rem;
      color: var(--page-color);
      display: block;
      font-size: .8rem;
      height: 1.8rem;
      line-height: 1.2rem;
      max-width: 100%;
      outline: 0;
      padding: .25rem .4rem;
      position: relative;
      transition: .2s, border .2s, box-shadow .2s, color .2s;
      width: 100%;
      transition: all 0.3s ease-in-out;
    }

    @media screen and (min-width: 1000px) {
      .searchform-container {
        padding-left: 5rem;
        padding-right: 5rem;
      }

      #searchform {
        width: 62%;
        box-shadow: 0px 2px 8px rgb(37 44 54 / 25%);
      }
    }
  </style>
  <style>
    :root {
  --light-grey: #ccc;
  --item-hover-grey: #464646;
  --button-grey: #757575;
  --button-bg-grey: #f1f1f1;
}

.search {
  width: 36rem;
  margin: 0 auto;
  margin-top: 5rem;
  font-family: Arial;
}
.search__suggestions {
  border: 1px solid var(--light-grey);
  border-top: 0;
  font-size: 16px;
  font-family: Arial;
}

.search__suggestions__list {
  padding-right: 1rem;
  line-height: 1.5;
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.search__suggestions__list__result {
  padding-left: 1rem;
  padding-right: 1rem;
  padding-top: 0.5rem;
  padding-bottom: 0.5rem;
  
}

.search__suggestions__list__result:hover {
  background: var(--item-hover-grey);
  cursor: default;
}

.search__actions {
  margin-top: 2rem;
  text-align: center;
}

.search__actions--autosuggest {
  margin: 0;
  border: 1px solid var(--light-grey);
  border-top: 0;
  padding: 1rem 0 0.1rem 0;
}

.search__actions__action {
  height: 2rem;
  font-size: 13px;
  font-weight: bold;
  font-family: Arial;
  color: var(--button-grey);
  background: var(--button-bg-grey);
  padding: 0.4rem 1rem;
  outline: none;
  border: none;
  margin: 0.2 0.2rem;
}

.search__actions__action:hover {
  color: black;
  box-shadow: 0 0 1px #A9A9A9;
}
  </style>
  <!-- dark theme -->



  <div id="main">
    <!-- theme toggler button -->
    <div class="container">
      <div class="row">
        <h1 class="heading">Jha Search</h1>

        <div class="searchform-container">
          <center>
            <form class="form" action="/search" method="GET" id="searchform">
              <span id="search-icon" class="no-display">
                <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M6.57212 13.1442C2.94254 13.1442 0 10.2016 0 6.57173C0 2.94248 2.94268 0 6.57212 0C10.2016 0 13.1442 2.94248 13.1442 6.57173C13.1442 8.05658 12.6519 9.42642 11.8215 10.5269L16.3528 15.0581C16.7103 15.4156 16.7103 15.9952 16.3528 16.3527C15.9953 16.7102 15.4157 16.7102 15.0582 16.3527L10.527 11.8215C9.42657 12.6519 8.05682 13.1442 6.57212 13.1442ZM6.57212 11.2665C3.97956 11.2665 1.87775 9.16463 1.87775 6.57184C1.87775 3.97952 3.97966 1.87775 6.57212 1.87775C9.16458 1.87775 11.2665 3.97952 11.2665 6.57184C11.2665 9.16463 9.16468 11.2665 6.57212 11.2665Z"
                    fill="url(#paint0_linear)"></path>
                  <defs>
                    <linearGradient id="paint0_linear" x1="16.6209" y1="16.6208" x2="-1.90605" y2="3.18655"
                      gradientUnits="userSpaceOnUse">
                      <stop stop-color="#BF14A2"></stop>
                      <stop offset="1" stop-color="#F73A1C"></stop>
                    </linearGradient>
                  </defs>
                </svg>
              </span>
              <input name="query" id='query' type="text" class="form-input search__bar__input"
                placeholder="Search the world without being trackedâ€¦" name="q" value="{{ request.GET.query}}"
                autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false" aria-label="Search"
                title="Search" aria-autocomplete="both" aria-haspopup="false" maxlength="2048" autofocus="">
              <input name="source" value="web" type="hidden">
              <div id="autocomplete" class="svelte-ir7f0d"></div>
              <div class="search__suggestions autocomplete-items">
                <ul class="search__suggestions__list">
                </ul>
              </div>
            </form>
          </center>
        </div>
        <br>
      </div>
    </div>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
      crossorigin="anonymous"></script>
    <!-- dark theme toggler  script -->
    <script>
const HOST = 'server.com/';

const searchInput = document.getElementsByClassName('search__bar__input')[0];
const suggestionsElement = document.getElementsByClassName('search__suggestions__list')[0];
const actionsElement = document.getElementsByClassName('search__actions')[0];

function wrapBoldedCharacters({inputValue, suggestion}) {
  if (suggestion.startsWith(inputValue)) {
    return `${suggestion.substring(0, inputValue.length)}<b>${suggestion.substring(inputValue.length, suggestion.length)}</b>`;
  }
  return `<b>${suggestion}</b>`;
}

function createSuggestionElement({suggestion, auxiliaryData}) {
  const auxiliaryString = auxiliaryData ? ` - ${auxiliaryData}` : "";
  const boldProcessedSuggestion = wrapBoldedCharacters({
    inputValue: searchInput.value,
    suggestion
  });
  return `<li class="search__suggestions__list__result">${boldProcessedSuggestion}${auxiliaryString}</li>`
}

function onSuggestionsResponse(data) {
  let suggestionsHTML = "";
  for (const suggestion of data) {
    suggestionsHTML += createSuggestionElement({
      suggestion: suggestion.suggestion,
      auxiliaryData: suggestion.auxiliary
    });
  }
  suggestionsElement.innerHTML = suggestionsHTML;
  if (suggestionsHTML) {
    actionsElement.classList.add('search__actions--autosuggest');
  } else {
    actionsElement.classList.remove('search__actions--autosuggest');
  }
}

function onNewInput(event) {
  if (searchInput.value) {
    api.get(HOST + 'autocomplete', searchInput.value, onSuggestionsResponse);
  } else {
    suggestionsElement.innerHTML = '';
    actionsElement.classList.remove('search__actions--autosuggest');
  }
}

searchInput.oninput = onNewInput;


// Server

function getRandomString({length}) { 
  const characterChoices = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 "; 
  const characters = [];
  while (characters.length < length) {
    const randomIndex = Math.floor(Math.random() * characterChoices.length);
    characters.push(characterChoices[randomIndex]);
  }
  return characters.join('');
}

function getRandomInteger({min, max}) {
  return Math.floor(Math.random() * (max - min) + min);
}

function generateSuggestion(prefix) {
  const RATIO_EXACT_MATCH = 0.3;
  const RATIO_AUTOCORRECT = 0.1;
  
  if (Math.random() < RATIO_AUTOCORRECT) {
    return getRandomString({ length: getRandomInteger({min: 1, max: prefix.length}) })
  }
  
  if (Math.random() < RATIO_EXACT_MATCH) {
    return prefix;
  }

  return prefix + getRandomString({ length: getRandomInteger({min: 1, max: 10}) })
}

function getAutocompleteHandler(data) {
  const MAX_CHARS = 10;
  const NUM_AUTOCOMPLETE_RESULTS = 10;
  const RATIO_AUXILIARY_DATA = 0.1;
  
  if (data.length > MAX_CHARS) {
    return [];
  }
  
  const results = [];
  while (results.length < NUM_AUTOCOMPLETE_RESULTS) {
    const suggestion = generateSuggestion(data)
    if (results.find(result => result.suggestion === suggestion)) {
      continue;
    }
    
    if (Math.random() < RATIO_AUXILIARY_DATA) {
      for (let i = 0; i < 2; i++) {
        results.push({
          suggestion, 
          auxiliary: getRandomString({ length: getRandomInteger({min: 5, max: 15}) }) 
        });
      }
    } else {
      results.push({ suggestion, auxiliary: "" });
    }
  }
  return results;
}

const endpoints = {
  "/": {
    "get": () => "hello world"
  },
  "/autocomplete": {
    "get": getAutocompleteHandler
  }
}

// API library

function getFunction(url, data, callback) {
  const domain = url.substring(0, url.indexOf("/"));
  const endpoint = url.substring(url.indexOf("/"), url.length);

  callback(endpoints[endpoint]["get"](data));
}

const api = {
  get: getFunction
};
    </script>

</body>